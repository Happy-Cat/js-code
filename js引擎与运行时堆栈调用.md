
# js引擎与运行时堆栈调用

**js引擎现在最流行的也就是v8引擎，主要分成两个部分：内存堆与调用栈，js运行的时候会将所有的变量存在堆里，所有的可执行方法放到栈中，js单线程 就是指所有栈里的方法都是按顺序依次执行，不会同时执行多个**

#### js运行环境工作机制：
**js引擎作为唯一主线程，按顺序解析代码，遇到函数声明就放到内存堆中，遇到函数调用就栈中**
**同步调用，按顺序先进先出逐个执行，当一个函数执行完弹出栈，下一个函数继续执行**
**异步调用，分发到web API ，异步调用弹出栈，继续下一个函数执行**
**web API中的异步函数执行完成，达到触发条件，回调函数推到回调队列中**
**Event Loop不断检测主线程很回调队列，当调用栈空了，就将回调队列中的第一个任务推入调用栈并执行**

**异步调用回调队列又分宏队列（例：settimeout）列与微队列（例：promise），当调用栈为空的时候会将微队里的首位推入调用栈执行，当有新的微任务产生就放入微队列末位，当微队列为空，调用栈为空，就将宏队列内的首位任务依次推入微队列，推入调用栈执行，此过程不断重复就是 event loop**